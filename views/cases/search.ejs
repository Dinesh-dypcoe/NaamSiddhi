<%- include('../partials/header') %>

<div class="pt-20">
    <div class="glass-effect rounded-lg p-8 max-w-7xl mx-auto">
        <!-- Search Form -->
        <div class="mb-8">
            <h1 class="text-3xl font-nasa text-blue-400 mb-6">Search Cases</h1>
            <form id="searchForm" class="space-y-6">
                <!-- Basic Search -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="text" 
                           name="query" 
                           placeholder="Search by case number, description, or location"
                           class="w-full bg-space-dark/50 border border-blue-400/30 rounded-md px-4 py-2 focus:outline-none focus:border-blue-400 transition-all text-gray-100">
                    
                    <select name="caseType"
                            class="w-full bg-space-dark/50 border border-blue-400/30 rounded-md px-4 py-2 focus:outline-none focus:border-blue-400 transition-all text-gray-100">
                        <option value="">All Case Types</option>
                        <option value="criminal">Criminal Case</option>
                        <option value="civil">Civil Case</option>
                        <option value="domestic">Domestic Violence</option>
                        <option value="cybercrime">Cybercrime</option>
                        <option value="other">Other</option>
                    </select>

                    <select name="status"
                            class="w-full bg-space-dark/50 border border-blue-400/30 rounded-md px-4 py-2 focus:outline-none focus:border-blue-400 transition-all text-gray-100">
                        <option value="">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="closed">Closed</option>
                        <option value="pending">Pending</option>
                    </select>
                </div>

                <!-- Advanced Search -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-gray-400 mb-2">Date Range</label>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="date" 
                                   name="dateFrom"
                                   class="w-full bg-space-dark/50 border border-blue-400/30 rounded-md px-4 py-2 focus:outline-none focus:border-blue-400 transition-all text-gray-100">
                            <input type="date" 
                                   name="dateTo"
                                   class="w-full bg-space-dark/50 border border-blue-400/30 rounded-md px-4 py-2 focus:outline-none focus:border-blue-400 transition-all text-gray-100">
                        </div>
                    </div>

                    <select name="priority"
                            class="w-full bg-space-dark/50 border border-blue-400/30 rounded-md px-4 py-2 focus:outline-none focus:border-blue-400 transition-all text-gray-100">
                        <option value="">All Priorities</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                    </select>

                    <input type="text" 
                           name="district" 
                           placeholder="Search by district"
                           class="w-full bg-space-dark/50 border border-blue-400/30 rounded-md px-4 py-2 focus:outline-none focus:border-blue-400 transition-all text-gray-100">
                </div>

                <!-- Search Button -->
                <div class="flex justify-center">
                    <button type="submit"
                            class="bg-blue-500 hover:bg-blue-600 text-white font-nasa px-8 py-3 rounded-md transition-all transform hover:scale-105 hover:shadow-lg hover:shadow-blue-500/20">
                        Search Cases
                    </button>
                </div>
            </form>
        </div>

        <!-- Results Section -->
        <div id="searchResults" class="space-y-4">
            <!-- Results will be dynamically added here -->
        </div>
    </div>
</div>

<script>
document.getElementById('searchForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const searchParams = new URLSearchParams();
    
    for (let [key, value] of formData.entries()) {
        if (value) searchParams.append(key, value);
    }

    try {
        const response = await fetch(`/cases/api/search?${searchParams.toString()}`);
        if (!response.ok) throw new Error('Search failed');
        
        const results = await response.json();
        displayResults(results);
    } catch (error) {
        console.error('Search error:', error);
        showNotification('Failed to perform search', 'error');
    }
});

function displayResults(results) {
    const resultsContainer = document.getElementById('searchResults');
    
    if (!results.cases || results.cases.length === 0) {
        resultsContainer.innerHTML = `
            <div class="text-center text-gray-400 py-8">
                No cases found matching your search criteria
            </div>
        `;
        return;
    }

    resultsContainer.innerHTML = results.cases.map(case_ => `
        <div class="glass-effect p-6 rounded-lg hover:bg-blue-400/5 transition-all">
            <div class="flex justify-between items-start">
                <div>
                    <h3 class="text-xl font-nasa text-blue-400">
                        Case #${case_.caseNumber}
                    </h3>
                    <p class="text-gray-400 mt-1">
                        ${case_.caseType.charAt(0).toUpperCase() + case_.caseType.slice(1)} Case
                    </p>
                </div>
                <span class="px-3 py-1 rounded-full text-sm font-nasa
                    ${case_.status === 'active' ? 'bg-green-500/20 text-green-400' : 
                    case_.status === 'pending' ? 'bg-yellow-500/20 text-yellow-400' : 
                    'bg-red-500/20 text-red-400'}">
                    ${case_.status.charAt(0).toUpperCase() + case_.status.slice(1)}
                </span>
            </div>
            
            <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
                <div>
                    <p class="text-gray-400">Location</p>
                    <p class="text-white">${case_.location.city.english}, ${case_.location.district.english}</p>
                </div>
                <div>
                    <p class="text-gray-400">Date Filed</p>
                    <p class="text-white">${new Date(case_.createdAt).toLocaleDateString()}</p>
                </div>
            </div>

            <div class="mt-4 flex justify-end">
                <a href="/cases/${case_._id}" 
                   class="bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 font-nasa px-4 py-2 rounded-md transition-all">
                    View Details
                </a>
            </div>
        </div>
    `).join('');
}
</script>

<script src="/js/caseSearch.js"></script>

<%- include('../partials/footer') %> 